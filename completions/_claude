#compdef claude

_claude() {
  local curcontext="$curcontext" state line
  typeset -A opt_args

  _arguments -C \
    '1: :->command' \
    '*:: :->args' \
    '--add-dir[Additional directories to allow tool access to]:directories:_files -/' \
    '--agent[Agent for the current session]:agent:' \
    '--agents[JSON object defining custom agents]:json:' \
    '--allow-dangerously-skip-permissions[Enable bypassing permission checks as an option]' \
    '--allowed-tools[List of tool names to allow]:tools:' \
    '--append-system-prompt[Append a system prompt]:prompt:' \
    '--betas[Beta headers to include]:betas:' \
    '--chrome[Enable Claude in Chrome integration]' \
    '(-c --continue)'{-c,--continue}'[Continue the most recent conversation]' \
    '--dangerously-skip-permissions[Bypass all permission checks]' \
    '(-d --debug)'{-d,--debug}'[Enable debug mode]:filter:' \
    '--debug-file[Write debug logs to a file]:path:_files' \
    '--disable-slash-commands[Disable all skills]' \
    '--disallowed-tools[List of tool names to deny]:tools:' \
    '--fallback-model[Enable automatic fallback]:model:' \
    '--file[File resources to download]:specs:' \
    '--fork-session[Create a new session ID when resuming]' \
    '--from-pr[Resume a session linked to a PR]:pr:' \
    '(-h --help)'{-h,--help}'[Display help for command]' \
    '--ide[Automatically connect to IDE on startup]' \
    '--include-partial-messages[Include partial message chunks]' \
    '--input-format[Input format]:format:(text stream-json)' \
    '--json-schema[JSON Schema for structured output]:schema:' \
    '--max-budget-usd[Maximum dollar amount to spend]:amount:' \
    '--mcp-config[Load MCP servers from JSON]:configs:_files' \
    '--mcp-debug[Enable MCP debug mode]' \
    '--model[Model for the current session]:model:(sonnet opus haiku)' \
    '--no-chrome[Disable Claude in Chrome integration]' \
    '--no-session-persistence[Disable session persistence]' \
    '--output-format[Output format]:format:(text json stream-json)' \
    '--permission-mode[Permission mode]:mode:(acceptEdits bypassPermissions default delegate dontAsk plan)' \
    '--plugin-dir[Load plugins from directories]:paths:_files -/' \
    '(-p --print)'{-p,--print}'[Print response and exit]' \
    '--replay-user-messages[Re-emit user messages]' \
    '(-r --resume)'{-r,--resume}'[Resume a conversation]:session:' \
    '--session-id[Use a specific session ID]:uuid:' \
    '--setting-sources[List of setting sources]:sources:' \
    '--settings[Path to settings JSON file]:file:_files' \
    '--strict-mcp-config[Only use MCP servers from --mcp-config]' \
    '--system-prompt[System prompt to use]:prompt:' \
    '--tools[List of available tools]:tools:' \
    '--verbose[Override verbose mode setting]' \
    '(-v --version)'{-v,--version}'[Output the version number]'

  case "$state" in
    command)
      local -a commands
      commands=(
        'doctor:Check the health of your Claude Code auto-updater'
        'install:Install Claude Code native build'
        'mcp:Configure and manage MCP servers'
        'plugin:Manage Claude Code plugins'
        'setup-token:Set up a long-lived authentication token'
        'update:Check for updates and install if available'
      )
      _describe -t commands 'claude command' commands
      ;;
    args)
      case "$line[1]" in
        install)
          _arguments \
            '--help[Display help for command]' \
            '1:target:(stable latest)'
          ;;
        mcp)
          _arguments \
            '--help[Display help for command]' \
            '1:subcommand:(add remove list)'
          ;;
        plugin)
          _arguments \
            '--help[Display help for command]' \
            '1:subcommand:(install uninstall list)'
          ;;
        *)
          _message 'prompt'
          ;;
      esac
      ;;
  esac
}

_claude "$@"
